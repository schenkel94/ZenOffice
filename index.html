<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZenOffice</title>
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" type="image/png" href="icon.png">

    <!-- Bibliotecas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { -webkit-tap-highlight-color: transparent; user-select: none; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background-color: #4f46e5; border-radius: 10px; }
        
        .animate-fadeIn { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        @keyframes breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.5); }
        }
        .breathing-active { animation: breathe 12s infinite ease-in-out; }
        
        /* Ajuste para garantir que o FAB não cubra conteúdo */
        .safe-bottom { padding-bottom: 160px; }
    </style>
</head>
<body class="bg-slate-900 text-white overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        // --- Ícones ---
        const Icons = {
            Sun: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>,
            Moon: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>,
            Play: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
            Pause: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>,
            RotateCcw: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>,
            Check: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            Trash: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
            Brain: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"/><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"/></svg>,
            Wind: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg>,
            Coffee: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>,
            X: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Bell: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>,
            BarChart: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="16"/></svg>,
            Volume2: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>,
            Square: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" /></svg>,
            Download: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
        };

        const { useState, useEffect, useRef, useContext, createContext } = React;

        const MOTIVATIONAL_QUOTES = [
            "O sucesso é a soma de pequenos esforços.",
            "Descanse, mas não desista.",
            "Hoje é um ótimo dia para começar.",
            "Respire fundo. Você consegue.",
            "Um passo de cada vez.",
            "Sua saúde mental vem primeiro.",
            "Foco no progresso, não na perfeição."
        ];

        // --- CONTEXTO DE ÁUDIO GLOBAL ---
        // Isso permite que o som toque mesmo mudando de aba
        const SoundContext = createContext();
        const SoundProvider = ({ children }) => {
            const audioRef = useRef(null);
            const [soundPlaying, setSoundPlaying] = useState(null);

            const toggleSound = (soundFile) => {
                if (soundPlaying === soundFile) {
                    // Se clicar no mesmo, pausa
                    if(audioRef.current) audioRef.current.pause();
                    setSoundPlaying(null);
                } else {
                    // Se for novo som, troca
                    if (audioRef.current) audioRef.current.pause();
                    audioRef.current = new Audio(soundFile);
                    audioRef.current.loop = true; // Loop infinito
                    audioRef.current.play().catch(e => console.log("Erro áudio:", e));
                    setSoundPlaying(soundFile);
                }
            };

            const stopAudio = () => {
                if (audioRef.current) {
                    audioRef.current.pause();
                    audioRef.current.currentTime = 0;
                }
                setSoundPlaying(null);
            };

            return (
                <SoundContext.Provider value={{ soundPlaying, toggleSound, stopAudio }}>
                    {children}
                </SoundContext.Provider>
            );
        };

        // --- Contexto para Dados do Usuário ---
        const UserContext = createContext();
        const UserProvider = ({ children }) => {
            const [xp, setXp] = useState(() => parseInt(localStorage.getItem('zenXP') || '0'));
            const [history, setHistory] = useState(() => JSON.parse(localStorage.getItem('zenHistory') || '{}'));

            useEffect(() => localStorage.setItem('zenXP', xp), [xp]);
            useEffect(() => localStorage.setItem('zenHistory', JSON.stringify(history)), [history]);

            const level = Math.floor(xp / 500) + 1;
            const addFocusTime = (minutes) => {
                const gainedXP = minutes * 4;
                setXp(prev => prev + gainedXP);
                const today = new Date().toISOString().split('T')[0];
                setHistory(prev => ({...prev, [today]: (prev[today] || 0) + minutes}));
                return gainedXP;
            };

            return (
                <UserContext.Provider value={{ xp, level, history, addFocusTime }}>
                    {children}
                </UserContext.Provider>
            );
        };

        // --- Componentes ---

        const FocusMode = () => {
            const [timeLeft, setTimeLeft] = useState(25 * 60);
            const [isActive, setIsActive] = useState(false);
            const [mode, setMode] = useState('work');
            
            const { addFocusTime } = useContext(UserContext);
            const { soundPlaying, toggleSound, stopAudio } = useContext(SoundContext);
            const alarmRef = useRef(null);

            useEffect(() => {
                let interval = null;
                if (isActive && timeLeft > 0) {
                    interval = setInterval(() => setTimeLeft(timeLeft - 1), 1000);
                } else if (timeLeft === 0 && isActive) {
                    setIsActive(false);
                    if (!alarmRef.current) alarmRef.current = new Audio('alarme.mp3');
                    alarmRef.current.play().catch(e => console.log("Erro som:", e));

                    if (mode === 'work') {
                        const earned = addFocusTime(25);
                        alert(`Foco concluído! Você ganhou +${earned} XP!`);
                        if("Notification" in window && Notification.permission === "granted") {
                             new Notification("ZenOffice", { body: "Ciclo concluído!", icon: "icon.png" });
                        }
                    }
                    stopAudio(); // Para o som ambiente ao acabar
                }
                return () => clearInterval(interval);
            }, [isActive, timeLeft]);

            const formatTime = (s) => `${Math.floor(s / 60)}:${(s % 60).toString().padStart(2, '0')}`;

            return (
                <div className="flex flex-col items-center justify-center space-y-8 animate-fadeIn mt-6 safe-bottom">
                    <h2 className="text-3xl font-bold tracking-tight">Modo Foco</h2>
                    
                    <div className="relative">
                        <div className={`w-72 h-72 rounded-full border-4 flex items-center justify-center transition-all duration-500 ${isActive ? 'border-indigo-500 shadow-[0_0_40px_rgba(79,70,229,0.4)]' : 'border-gray-700'}`}>
                            <span className="text-7xl font-mono font-bold">{formatTime(timeLeft)}</span>
                        </div>
                    </div>

                    <div className="flex items-center gap-6">
                        <button onClick={() => {setIsActive(false); setTimeLeft(mode==='work'?25*60:5*60)}} className="p-4 rounded-full bg-gray-800 hover:bg-gray-700 transition-all"><Icons.RotateCcw size={24} /></button>
                        <button onClick={() => setIsActive(!isActive)} className="p-6 rounded-full bg-indigo-600 hover:bg-indigo-500 shadow-xl hover:scale-105 transition-all">
                            {isActive ? <Icons.Pause size={32} fill="white" /> : <Icons.Play size={32} fill="white" />}
                        </button>
                    </div>

                    <div className="flex gap-2 p-1 bg-gray-800 rounded-xl">
                        {[{id:'work',l:'Foco'}, {id:'shortBreak',l:'Curta'}, {id:'longBreak',l:'Longa'}].map(m => (
                            <button key={m.id} onClick={() => {setIsActive(false); setMode(m.id); setTimeLeft(m.id==='work'?25*60:m.id==='shortBreak'?5*60:15*60)}} 
                                className={`px-5 py-2 rounded-lg text-sm font-medium transition-all ${mode === m.id ? 'bg-slate-600 text-white' : 'text-gray-400 hover:text-white'}`}>
                                {m.l}
                            </button>
                        ))}
                    </div>

                    {/* Controles de Som Global */}
                    <div className="w-full pt-6 border-t border-gray-800">
                        <p className="text-center text-xs text-gray-500 mb-3 uppercase tracking-wider">Sons de Ambiente</p>
                        <div className="flex justify-center items-center gap-3 flex-wrap">
                            {[{n:'Foco',f:'foco.mp3'},{n:'Natureza',f:'natureza.mp3'},{n:'Lo-Fi',f:'lo-fi.mp3'}].map(s => (
                                <button key={s.n} onClick={() => toggleSound(s.f)} className={`p-3 rounded-xl w-20 flex flex-col items-center gap-1 transition-all ${soundPlaying === s.f ? 'bg-indigo-600 text-white' : 'bg-gray-800 text-gray-400'}`}>
                                    <Icons.Volume2 size={20} /> <span className="text-[10px]">{s.n}</span>
                                </button>
                            ))}
                            <button onClick={stopAudio} className={`p-3 rounded-xl w-20 flex flex-col items-center gap-1 transition-all bg-red-900/30 text-red-400 hover:bg-red-900/50 ${!soundPlaying && 'opacity-50'}`}>
                                <Icons.Square size={20} fill="currentColor" /> <span className="text-[10px]">Parar</span>
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const TasksMode = () => {
            const [tasks, setTasks] = useState(() => JSON.parse(localStorage.getItem('zenTasks') || '[]'));
            const [input, setInput] = useState('');
            const [time, setTime] = useState('');
            
            useEffect(() => localStorage.setItem('zenTasks', JSON.stringify(tasks)), [tasks]);

            // Lembrete simples
            useEffect(() => {
                const interval = setInterval(() => {
                    const now = new Date();
                    const current = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
                    tasks.forEach(t => {
                        if(t.time === current && !t.notified && !t.done) {
                            // Tenta enviar notificação
                            if(Notification.permission === 'granted') {
                                new Notification("Lembrete", { body: t.text, icon: 'icon.png' });
                            }
                            setTasks(prev => prev.map(p => p.id === t.id ? {...p, notified: true} : p));
                        }
                    });
                }, 30000);
                return () => clearInterval(interval);
            }, [tasks]);

            const addTask = (e) => {
                e.preventDefault();
                if(!input) return;
                setTasks([...tasks, {id: Date.now(), text: input, time, done: false, notified: false}]);
                setInput(''); setTime('');
            };

            const checkPermission = () => {
                if (!("Notification" in window)) {
                    alert("Este navegador não suporta notificações de sistema.");
                } else if (Notification.permission === "granted") {
                    new Notification("Teste", { body: "Notificações estão ativadas!", icon: "icon.png" });
                } else if (Notification.permission !== "denied") {
                    Notification.requestPermission().then(permission => {
                        if (permission === "granted") {
                            new Notification("Sucesso", { body: "Agora você receberá lembretes!", icon: "icon.png" });
                        }
                    });
                } else {
                    alert("Notificações estão bloqueadas. Ative nas configurações do navegador.");
                }
            };

            return (
                <div className="w-full max-w-md mx-auto animate-fadeIn mt-6 safe-bottom">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-3xl font-bold">Tarefas</h2>
                        <button onClick={checkPermission} className="text-xs bg-gray-800 px-3 py-1 rounded-full text-indigo-400 border border-indigo-900">
                            Testar Notificação
                        </button>
                    </div>
                    
                    <form onSubmit={addTask} className="bg-gray-800 p-4 rounded-2xl mb-6">
                        <input value={input} onChange={e=>setInput(e.target.value)} placeholder="Nova tarefa..." className="w-full bg-transparent border-b border-gray-600 text-white p-2 outline-none mb-3"/>
                        <div className="flex justify-between items-center">
                            <input type="time" value={time} onChange={e=>setTime(e.target.value)} className="bg-gray-700 text-white text-sm rounded p-1"/>
                            <button type="submit" className="bg-indigo-600 px-4 py-2 rounded-lg text-sm font-bold">Adicionar</button>
                        </div>
                    </form>

                    <div className="space-y-3">
                        {tasks.map(t => (
                            <div key={t.id} className={`flex items-center p-4 bg-gray-800 rounded-xl border border-gray-700 ${t.done ? 'opacity-50' : ''}`}>
                                <button onClick={()=>setTasks(tasks.map(x=>x.id===t.id?{...x, done:!x.done}:x))} className={`w-6 h-6 rounded-full border-2 mr-3 flex items-center justify-center ${t.done ? 'bg-green-500 border-green-500' : 'border-gray-500'}`}>
                                    {t.done && <Icons.Check size={14} />}
                                </button>
                                <div className="flex-1">
                                    <p className={t.done ? 'line-through' : ''}>{t.text}</p>
                                    {t.time && <p className="text-xs text-indigo-400 flex items-center gap-1"><Icons.Bell size={10}/> {t.time}</p>}
                                </div>
                                <button onClick={()=>setTasks(tasks.filter(x=>x.id!==t.id))} className="text-gray-500 hover:text-red-500"><Icons.Trash size={18}/></button>
                            </div>
                        ))}
                        {tasks.length === 0 && <p className="text-center text-gray-600 mt-10">Nenhuma tarefa pendente.</p>}
                    </div>
                </div>
            );
        };

        const ZenMode = () => {
            const [tab, setTab] = useState('breathe');
            const playPop = () => { const a = new Audio('bubble.mp3'); a.volume=0.5; a.play().catch(()=>{}); if(navigator.vibrate) navigator.vibrate(50); };

            const Breathing = () => {
                const [active, setActive] = useState(false);
                const [phase, setPhase] = useState('Toque para Iniciar');
                
                useEffect(() => {
                    let interval;
                    if (active) {
                        const runCycle = () => {
                            setPhase('Inspire');
                            setTimeout(() => {
                                setPhase('Segure');
                                setTimeout(() => {
                                    setPhase('Expire');
                                }, 4000);
                            }, 4000);
                        };
                        runCycle();
                        interval = setInterval(runCycle, 12000);
                    } else {
                        setPhase('Toque para Iniciar');
                        clearInterval(interval);
                    }
                    return () => clearInterval(interval);
                }, [active]);

                return (
                    <div className="flex flex-col items-center justify-center py-12 safe-bottom">
                        <div 
                            onClick={() => setActive(!active)}
                            className="cursor-pointer relative flex items-center justify-center w-64 h-64 select-none"
                        >
                            <div className={`absolute rounded-full bg-indigo-500/20 w-40 h-40 transition-transform duration-[4000ms] ease-in-out ${active && phase !== 'Expire' ? 'scale-150' : 'scale-100'}`}></div>
                            <div className={`absolute rounded-full bg-indigo-500/40 w-32 h-32 transition-transform duration-[4000ms] ease-in-out ${active && phase !== 'Expire' ? 'scale-150' : 'scale-100'}`}></div>
                            <div className="absolute w-40 h-40 bg-indigo-600 rounded-full flex items-center justify-center shadow-2xl shadow-indigo-500/50 z-10">
                                <span className="font-bold text-xl text-center px-4 animate-fadeIn">{phase}</span>
                            </div>
                        </div>
                        <p className="mt-12 text-gray-400 text-sm">Técnica 4-4-4</p>
                    </div>
                );
            };

            const BubbleWrap = () => {
                const [bubbles, setBubbles] = useState(Array(20).fill(false));
                const pop = (i) => { if(bubbles[i]) return; playPop(); const n = [...bubbles]; n[i] = true; setBubbles(n); };
                return (
                    <div className="flex flex-col items-center w-full safe-bottom">
                        <div className="grid grid-cols-4 gap-4 mb-6">
                            {bubbles.map((p, i) => (
                                <button key={i} onClick={() => pop(i)} className={`w-16 h-16 rounded-full shadow-inner transition-all ${p ? 'bg-transparent border-2 border-dashed border-gray-600 scale-90' : 'bg-gradient-to-br from-indigo-500 to-blue-600 shadow-xl active:scale-95'}`}></button>
                            ))}
                        </div>
                        <button onClick={() => setBubbles(Array(20).fill(false))} className="text-indigo-400 underline text-sm">Novo Plástico</button>
                    </div>
                );
            };

            return (
                <div className="w-full max-w-md mx-auto animate-fadeIn mt-6 flex flex-col items-center safe-bottom">
                    <h2 className="text-3xl font-bold mb-8">Modo Zen</h2>
                    <div className="flex bg-gray-800 p-1 rounded-full mb-4">
                        <button onClick={() => setTab('breathe')} className={`px-6 py-2 rounded-full text-sm font-medium transition-all ${tab === 'breathe' ? 'bg-indigo-600 text-white' : 'text-gray-400'}`}>Respirar</button>
                        <button onClick={() => setTab('bubble')} className={`px-6 py-2 rounded-full text-sm font-medium transition-all ${tab === 'bubble' ? 'bg-indigo-600 text-white' : 'text-gray-400'}`}>Relaxar</button>
                    </div>
                    {tab === 'breathe' ? <Breathing /> : <BubbleWrap />}
                </div>
            );
        };

        const StatsMode = () => {
             const { xp, level, history } = useContext(UserContext);
             const getLast7Days = () => {
                const days = [];
                for(let i=6; i>=0; i--) {
                    const d = new Date(); d.setDate(d.getDate()-i);
                    days.push({l: d.toLocaleDateString('pt-BR',{weekday:'short'}).slice(0,3), v: history[d.toISOString().split('T')[0]] || 0});
                }
                return days;
             };
             const data = getLast7Days();
             const max = Math.max(...data.map(d=>d.v), 60);

             return (
                 <div className="w-full max-w-md mx-auto animate-fadeIn mt-6 safe-bottom">
                    <h2 className="text-3xl font-bold mb-6 text-center">Estatísticas</h2>
                    <div className="bg-gradient-to-r from-indigo-600 to-purple-700 rounded-2xl p-6 mb-6 shadow-lg">
                        <p className="text-indigo-200 text-xs font-bold uppercase">Nível {level}</p>
                        <p className="text-4xl font-bold mt-1">{xp} <span className="text-sm font-normal text-indigo-200">XP Total</span></p>
                        <div className="w-full bg-black/20 h-2 rounded-full mt-4 overflow-hidden">
                            <div className="bg-white h-full" style={{width: `${(xp%500)/5}%`}}></div>
                        </div>
                        <p className="text-right text-[10px] mt-1 text-indigo-200">{xp%500}/500 para próximo nível</p>
                    </div>
                    <div className="bg-gray-800 p-6 rounded-2xl border border-gray-700">
                        <h3 className="font-bold mb-4 flex gap-2 items-center text-sm"><Icons.BarChart size={16}/> Minutos Focados (7 dias)</h3>
                        <div className="flex items-end justify-between h-32 gap-2">
                            {data.map((d,i) => (
                                <div key={i} className="flex flex-col items-center flex-1 h-full justify-end group">
                                    <div className="w-full bg-indigo-500 rounded-t-sm transition-all relative" style={{height: `${(d.v/max)*100}%`}}>
                                        {d.v > 0 && <span className="absolute -top-6 left-1/2 -translate-x-1/2 bg-white text-black text-[10px] px-1 rounded opacity-0 group-hover:opacity-100">{d.v}m</span>}
                                    </div>
                                    <span className="text-[10px] text-gray-500 mt-2 uppercase">{d.l}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                 </div>
             );
        };

        const DonationModal = ({ close }) => {
            const [slide, setSlide] = useState('donate');
            return (
                <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fadeIn">
                    <div className="bg-slate-800 w-full max-w-sm rounded-3xl overflow-hidden shadow-2xl border border-gray-700 relative h-[500px] flex flex-col">
                        <div className="flex border-b border-gray-700">
                             <button onClick={()=>setSlide('donate')} className={`flex-1 py-4 text-sm font-bold ${slide==='donate'?'text-indigo-400 border-b-2 border-indigo-400':'text-gray-500'}`}>APOIAR</button>
                             <button onClick={()=>setSlide('about')} className={`flex-1 py-4 text-sm font-bold ${slide==='about'?'text-indigo-400 border-b-2 border-indigo-400':'text-gray-500'}`}>SOBRE</button>
                        </div>
                        <button onClick={close} className="absolute top-4 right-4 text-gray-400 hover:text-white"><Icons.X /></button>
                        <div className="flex-1 relative">
                            <div className={`absolute w-[200%] h-full flex transition-transform duration-500 ${slide==='about'?'-translate-x-1/2':'translate-x-0'}`}>
                                <div className="w-1/2 h-full p-6 flex flex-col items-center justify-center text-center space-y-4">
                                    <div className="w-16 h-16 bg-gradient-to-tr from-yellow-400 to-orange-500 rounded-full flex items-center justify-center shadow-lg mb-2"><Icons.Coffee size={32} className="text-white" /></div>
                                    <h2 className="text-xl font-bold">Café pro Desenvolvedor? ☕</h2>
                                    <p className="text-sm text-gray-400">Ajude a manter o projeto no ar e sem anúncios!</p>
                                    <div className="bg-white p-3 rounded-xl w-40 h-40 flex items-center justify-center my-2">
                                        <img src="qr.png" className="max-w-full max-h-full" onError={(e)=>{e.target.style.display='none'; e.target.nextSibling.style.display='block'}}/>
                                        <span className="text-black text-xs hidden">QR Code não encontrado</span>
                                    </div>
                                    <button onClick={()=>{navigator.clipboard.writeText('schenkel.mario@hotmail.com'); alert('Chave copiada!')}} className="w-full py-3 bg-indigo-600 hover:bg-indigo-500 rounded-xl font-bold text-sm shadow-lg shadow-indigo-500/20">Copiar Chave Pix</button>
                                    <p className="text-[10px] text-gray-500 font-mono">schenkel.mario@hotmail.com</p>
                                </div>
                                <div className="w-1/2 h-full p-6 flex flex-col items-center justify-center text-center space-y-4">
                                     <div className="w-24 h-24 rounded-full border-4 border-indigo-500 overflow-hidden shadow-xl mb-2">
                                        <img src="profile.png" className="w-full h-full object-cover" onError={(e)=>{e.target.style.display='none'; e.target.parentElement.style.backgroundColor='#333'}} />
                                     </div>
                                     <h2 className="text-xl font-bold">Mário Schenkel</h2>
                                     <p className="text-indigo-400 text-sm font-medium">Criador do ZenOffice</p>
                                     <p className="text-sm text-gray-400">Focado em criar soluções que trazem paz e produtividade para o seu dia a dia.</p>
                                     <a href="https://linkedin.com/in/marioschenkel" target="_blank" className="px-6 py-2 bg-blue-700 text-white rounded-lg text-sm font-bold mt-4">LinkedIn</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('focus');
            const [darkMode, setDarkMode] = useState(true);
            const [showModal, setShowModal] = useState(false);
            const [quote, setQuote] = useState('');
            const [cookieConsent, setCookieConsent] = useState(() => localStorage.getItem('zenConsent'));
            const [deferredPrompt, setDeferredPrompt] = useState(null);

            useEffect(() => {
                setQuote(MOTIVATIONAL_QUOTES[Math.floor(Math.random() * MOTIVATIONAL_QUOTES.length)]);
                
                // Lógica de Instalação PWA
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    setDeferredPrompt(e);
                });
            }, []);

            const installApp = async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    setDeferredPrompt(null);
                }
            };

            const acceptCookies = () => {
                localStorage.setItem('zenConsent', 'true');
                setCookieConsent('true');
            };

            return (
                <div className={`h-screen w-screen flex flex-col ${darkMode ? 'bg-slate-900 text-white' : 'bg-slate-50 text-gray-900'} transition-colors duration-300`}>
                    
                    <header className="px-6 pt-6 pb-2 flex justify-between items-center z-10">
                        <div className="flex items-center gap-3">
                            <img src="icon.png" className="w-10 h-10 rounded-xl shadow-lg" onError={(e)=>e.target.style.display='none'} />
                            <div>
                                <h1 className="font-bold text-xl tracking-tight leading-none">ZenOffice</h1>
                                <p className="text-[10px] text-gray-400 tracking-widest mt-1 uppercase">{quote}</p>
                            </div>
                        </div>
                        <div className="flex gap-2">
                            {deferredPrompt && (
                                <button onClick={installApp} className="p-2 bg-emerald-600 rounded-full text-white animate-pulse">
                                    <Icons.Download size={20} />
                                </button>
                            )}
                            <button onClick={()=>setDarkMode(!darkMode)} className="p-2 bg-gray-800 rounded-full text-gray-300">
                                {darkMode ? <Icons.Sun size={20}/> : <Icons.Moon size={20}/>}
                            </button>
                        </div>
                    </header>

                    <main className="flex-1 overflow-y-auto px-6 w-full max-w-lg mx-auto">
                        {activeTab === 'focus' && <FocusMode />}
                        {activeTab === 'tasks' && <TasksMode />}
                        {activeTab === 'zen' && <ZenMode />}
                        {activeTab === 'stats' && <StatsMode />}
                    </main>

                    <button onClick={()=>setShowModal(true)} className="fixed bottom-24 right-6 w-14 h-14 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-full flex items-center justify-center shadow-xl shadow-orange-500/20 z-20 hover:scale-110 transition-transform">
                        <Icons.Coffee size={24} className="text-white" />
                    </button>

                    <nav className="fixed bottom-0 w-full bg-slate-900/90 backdrop-blur-md border-t border-gray-800 pb-6 pt-2 z-30">
                        <div className="flex justify-around items-center max-w-md mx-auto">
                            {[
                                {id:'focus', i:Icons.Brain, l:'Foco'},
                                {id:'tasks', i:Icons.Check, l:'Tarefas'},
                                {id:'stats', i:Icons.BarChart, l:'Stats'},
                                {id:'zen', i:Icons.Wind, l:'Zen'}
                            ].map(t => (
                                <button key={t.id} onClick={()=>setActiveTab(t.id)} className={`flex flex-col items-center p-2 transition-all ${activeTab===t.id ? 'text-indigo-500 -translate-y-1' : 'text-gray-500'}`}>
                                    <t.i size={24} />
                                    <span className="text-[10px] mt-1 font-medium">{t.l}</span>
                                </button>
                            ))}
                        </div>
                    </nav>

                    {showModal && <DonationModal close={()=>setShowModal(false)} />}
                    
                    {!cookieConsent && (
                        <div className="fixed bottom-0 w-full bg-slate-800 p-4 z-50 border-t border-gray-700 flex flex-col sm:flex-row items-center justify-between gap-4 animate-fadeIn">
                            <p className="text-xs text-gray-300 text-center sm:text-left">Utilizamos armazenamento local para salvar seu progresso. Sem rastreamento.</p>
                            <button onClick={acceptCookies} className="bg-indigo-600 px-6 py-2 rounded-lg text-sm font-bold w-full sm:w-auto">Aceitar</button>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            <UserProvider>
                <SoundProvider>
                    <App />
                </SoundProvider>
            </UserProvider>
        );
    </script>

    <script>
        if ('serviceWorker' in navigator) { window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js')); }
    </script>
</body>
</html>
