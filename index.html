<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZenOffice</title>
    
    <!-- Configurações PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4f46e5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" type="image/png" href="icon.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { -webkit-tap-highlight-color: transparent; user-select: none; }
        
        /* Scrollbar personalizada mas funcional no canto */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background-color: rgba(99, 102, 241, 0.3); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background-color: rgba(99, 102, 241, 0.6); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
        .animate-pop { animation: pop 0.2s ease-in-out; }
        @keyframes slideUp { from { height: 0; } to { height: var(--h); } }
        .bar-grow { animation: slideUp 1s ease-out forwards; }
    </style>
</head>
<body class="bg-slate-900 text-gray-100 font-sans selection:bg-indigo-500 selection:text-white overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        // --- Ícones (Lucide) ---
        const Icons = {
            Moon: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>,
            Sun: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>,
            Play: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
            Pause: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>,
            RotateCcw: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>,
            Volume2: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>,
            VolumeX: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="23" x2="17" y1="9" y2="15"/><line x1="17" x2="23" y1="9" y2="15"/></svg>,
            CheckCircle: ({size=24, ...p}) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
            Trash2: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
            Plus: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            Wind: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg>,
            Smile: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>,
            Brain: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"/><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"/><path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"/><path d="M17.599 6.5a3 3 0 0 0 .399-1.375"/><path d="M6.003 5.125A3 3 0 0 0 6.401 6.5"/><path d="M3.477 10.896a4 4 0 0 1 .585-.396"/><path d="M19.938 10.5a4 4 0 0 1 .585.396"/><path d="M6 18a4 4 0 0 1-1.907-1.063"/><path d="M19.907 16.937A4 4 0 0 1 18 18"/></svg>,
            Coffee: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>,
            X: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Bell: ({size=18, ...p}) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>,
            BellOff: ({size=18, ...p}) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8.7 3A6 6 0 0 1 18 8a2.13 2.13 0 0 0 .76 1.66"/><path d="M17 17H3s3-2 3-9c0-2.48 1.51-4.5 4-5.4"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/><line x1="2" x2="22" y1="2" y2="22"/></svg>,
            BellRing: ({size=18, ...p}) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/><path d="M4 2C2.8 3.7 2 5.7 2 8"/><path d="M22 8c0-2.3-.8-4.3-2-6"/></svg>,
            Cookie: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5"/><path d="M8.5 8.5v.01"/><path d="M16 15.5v.01"/><path d="M12 12v.01"/><path d="M11 17v.01"/><path d="M7 14v.01"/></svg>,
            User: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
            Linkedin: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect width="4" height="12" x="2" y="9"/><circle cx="4" cy="4" r="2"/></svg>,
            BarChart: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="16"/></svg>,
            Award: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>
        };

        const { useState, useEffect, useRef, useContext, createContext } = React;

        const UserContext = createContext();

        const UserProvider = ({ children }) => {
            const [xp, setXp] = useState(() => parseInt(localStorage.getItem('zenXP') || '0'));
            const [history, setHistory] = useState(() => JSON.parse(localStorage.getItem('zenHistory') || '{}'));

            useEffect(() => localStorage.setItem('zenXP', xp), [xp]);
            useEffect(() => localStorage.setItem('zenHistory', JSON.stringify(history)), [history]);

            const level = Math.floor(xp / 500) + 1;
            const addFocusTime = (minutes) => {
                const gainedXP = minutes * 4;
                setXp(prev => prev + gainedXP);
                const today = new Date().toISOString().split('T')[0];
                setHistory(prev => ({...prev, [today]: (prev[today] || 0) + minutes}));
                return gainedXP;
            };

            return (
                <UserContext.Provider value={{ xp, level, history, addFocusTime }}>
                    {children}
                </UserContext.Provider>
            );
        };

        const ToastContext = createContext();
        const ToastProvider = ({ children }) => {
            const [toasts, setToasts] = useState([]);
            const addToast = (msg) => {
                const id = Date.now();
                setToasts([...toasts, { id, msg }]);
                setTimeout(() => setToasts(prev => prev.filter(t => t.id !== id)), 3000);
            };
            return (
                <ToastContext.Provider value={addToast}>
                    {children}
                    <div className="fixed top-24 left-0 w-full flex flex-col items-center pointer-events-none z-50 gap-2">
                        {toasts.map(t => (
                            <div key={t.id} className="bg-indigo-600 text-white px-4 py-2 rounded-full shadow-lg backdrop-blur-sm animate-fadeIn text-sm font-bold flex items-center gap-2">
                                <Icons.Award size={16} /> {t.msg}
                            </div>
                        ))}
                    </div>
                </ToastContext.Provider>
            );
        };
        const useToast = () => useContext(ToastContext);

        const FocusMode = () => {
            const [timeLeft, setTimeLeft] = useState(25 * 60);
            const [isActive, setIsActive] = useState(false);
            const [mode, setMode] = useState('work');
            const [soundPlaying, setSoundPlaying] = useState(null);
            const { addFocusTime } = useContext(UserContext);
            const toast = useToast();
            const audioRef = useRef(null);
            const alarmRef = useRef(null);

            useEffect(() => {
                let interval = null;
                if (isActive && timeLeft > 0) {
                    interval = setInterval(() => setTimeLeft(timeLeft - 1), 1000);
                } else if (timeLeft === 0 && isActive) {
                    setIsActive(false);
                    if (!alarmRef.current) alarmRef.current = new Audio('alarme.mp3');
                    alarmRef.current.play().catch(e => console.log(e));
                    
                    if (mode === 'work') {
                        const earned = addFocusTime(25);
                        toast(`Foco concluído! +${earned} XP`);
                        new Notification("ZenOffice", { body: `Foco concluído! Você ganhou ${earned} XP!`, icon: 'icon.png' });
                    } else {
                        toast("Descanso finalizado!");
                        new Notification("ZenOffice", { body: "Hora de voltar ao trabalho!", icon: 'icon.png' });
                    }
                    if (audioRef.current) audioRef.current.pause();
                    setSoundPlaying(null);
                }
                return () => clearInterval(interval);
            }, [isActive, timeLeft]);

            const toggleSound = (soundFile) => {
                if (soundPlaying === soundFile) {
                    audioRef.current.pause();
                    setSoundPlaying(null);
                } else {
                    if (audioRef.current) audioRef.current.pause();
                    audioRef.current = new Audio(soundFile);
                    audioRef.current.loop = true;
                    audioRef.current.play().catch(e => toast("Clique na tela para ativar áudio"));
                    setSoundPlaying(soundFile);
                }
            };

            const formatTime = (s) => `${Math.floor(s / 60)}:${(s % 60).toString().padStart(2, '0')}`;
            const setTimer = (m) => {
                setIsActive(false); setMode(m);
                setTimeLeft(m === 'work' ? 25*60 : m === 'shortBreak' ? 5*60 : 15*60);
            };

            return (
                <div className="flex flex-col items-center justify-center space-y-8 w-full max-w-md mx-auto animate-fadeIn mt-6">
                    <div className="relative group">
                        <div className={`w-72 h-72 rounded-full border-[6px] flex items-center justify-center transition-all duration-500 ${isActive ? 'border-indigo-500 shadow-[0_0_50px_rgba(99,102,241,0.4)]' : 'border-gray-200 dark:border-gray-700'}`}>
                            <span className="text-7xl font-mono font-bold tracking-tighter">{formatTime(timeLeft)}</span>
                        </div>
                    </div>
                    <div className="flex space-x-6 items-center">
                        <button onClick={() => setTimer(mode)} className="p-4 rounded-full bg-gray-200 dark:bg-gray-800 transition-all shadow-md active:scale-95"><Icons.RotateCcw size={24} /></button>
                        <button onClick={() => setIsActive(!isActive)} className="p-6 rounded-full bg-indigo-600 hover:bg-indigo-500 text-white shadow-xl hover:scale-110 active:scale-95 transition-all">
                            {isActive ? <Icons.Pause size={32} fill="white" /> : <Icons.Play size={32} fill="white" />}
                        </button>
                        <div className="w-14"></div>
                    </div>
                    <div className="flex gap-2 p-1 bg-gray-100 dark:bg-gray-800 rounded-xl">
                        {[{id:'work',l:'Foco'}, {id:'shortBreak',l:'Curta'}, {id:'longBreak',l:'Longa'}].map(m => (
                            <button key={m.id} onClick={() => setTimer(m.id)} className={`px-5 py-2 rounded-lg text-sm font-medium transition-all ${mode === m.id ? 'bg-white dark:bg-gray-700 shadow-sm text-indigo-600 dark:text-indigo-400' : 'text-gray-500'}`}>{m.l}</button>
                        ))}
                    </div>
                    <div className="w-full pt-6 border-t border-gray-200 dark:border-gray-800">
                        <div className="flex justify-center gap-4">
                            {[{n:'Foco',f:'foco.mp3'},{n:'Natureza',f:'natureza.mp3'},{n:'Lo-Fi',f:'lo-fi.mp3'}].map(s => (
                                <button key={s.n} onClick={() => toggleSound(s.f)} className={`flex flex-col items-center gap-2 p-3 rounded-2xl transition-all w-24 ${soundPlaying === s.f ? 'bg-indigo-600 text-white shadow-lg' : 'bg-gray-100 dark:bg-gray-800 text-gray-500'}`}>
                                    {soundPlaying === s.f ? <Icons.Volume2 /> : <Icons.VolumeX />}
                                    <span className="text-xs font-medium">{s.n}</span>
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const StatsPage = () => {
            const { xp, level, history } = useContext(UserContext);
            const getLast7Days = () => {
                const days = [];
                for (let i = 6; i >= 0; i--) {
                    const d = new Date();
                    d.setDate(d.getDate() - i);
                    const dateStr = d.toISOString().split('T')[0];
                    const dayName = d.toLocaleDateString('pt-BR', { weekday: 'short' }).slice(0,3);
                    days.push({ label: dayName, val: history[dateStr] || 0 });
                }
                return days;
            };
            const data = getLast7Days();
            const maxVal = Math.max(...data.map(d => d.val), 60);

            return (
                <div className="w-full max-w-md mx-auto animate-fadeIn pt-4 space-y-6">
                    <h2 className="text-2xl font-bold mb-4">Seu Progresso</h2>
                    <div className="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl p-6 text-white shadow-lg relative overflow-hidden">
                        <div className="relative z-10">
                            <div className="flex justify-between items-end mb-2">
                                <span className="text-indigo-200 font-bold text-sm uppercase">Nível Atual</span>
                                <span className="text-4xl font-bold">{level}</span>
                            </div>
                            <div className="w-full bg-black/20 h-3 rounded-full overflow-hidden">
                                <div className="bg-white h-full transition-all duration-1000" style={{width: `${(xp % 500) / 5}%`}}></div>
                            </div>
                            <p className="text-right text-xs mt-2 text-indigo-100">{xp % 500} / 500 XP para o próximo nível</p>
                            <p className="mt-4 text-sm font-medium opacity-90">Total Acumulado: {xp} XP</p>
                        </div>
                        <Icons.Award className="absolute -bottom-4 -right-4 text-white opacity-10 w-32 h-32" />
                    </div>
                    <div className="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700">
                        <h3 className="font-bold mb-6 flex items-center gap-2 text-sm"><Icons.BarChart size={18}/> Foco Semanal (minutos)</h3>
                        <div className="flex items-end justify-between h-40 gap-2">
                            {data.map((d, i) => {
                                const height = (d.val / maxVal) * 100;
                                return (
                                    <div key={i} className="flex flex-col items-center flex-1 group">
                                        <div className="w-full bg-gray-100 dark:bg-gray-700 rounded-t-md relative h-full flex items-end overflow-hidden">
                                            <div className={`w-full bg-indigo-500 hover:bg-indigo-400 transition-all rounded-t-md bar-grow`} style={{'--h': `${height}%`}}></div>
                                        </div>
                                        <span className="text-[10px] mt-2 text-gray-400 font-medium uppercase">{d.label}</span>
                                        {d.val > 0 && <span className="absolute -mt-6 text-[10px] bg-gray-900 text-white px-1 rounded opacity-0 group-hover:opacity-100 transition-opacity">{d.val}m</span>}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        const TaskManager = () => {
            const [tasks, setTasks] = useState(() => JSON.parse(localStorage.getItem('zenTasks') || '[]'));
            const [input, setInput] = useState('');
            const [timeInput, setTimeInput] = useState('');
            const [notifyPerm, setNotifyPerm] = useState(Notification.permission);
            const toast = useToast();
            
            useEffect(() => localStorage.setItem('zenTasks', JSON.stringify(tasks)), [tasks]);

            useEffect(() => {
                const check = setInterval(() => {
                    const now = new Date();
                    const current = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
                    tasks.forEach(t => {
                        if (t.time === current && !t.notified && !t.done) {
                            new Notification("Lembrete ZenOffice", { body: t.text, icon: 'icon.png' });
                            if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
                            setTasks(prev => prev.map(p => p.id === t.id ? {...p, notified: true} : p));
                        }
                    });
                }, 30000);
                return () => clearInterval(check);
            }, [tasks]);

            const requestPerm = async () => {
                const perm = await Notification.requestPermission();
                setNotifyPerm(perm);
                toast(perm === 'granted' ? "Notificações ativadas!" : "Bloqueado pelo navegador");
            };

            const addTask = (e) => {
                e.preventDefault();
                if (!input.trim()) return;
                setTasks([...tasks, { id: Date.now(), text: input, done: false, time: timeInput, notified: false }]);
                setInput(''); setTimeInput('');
                if (timeInput && notifyPerm !== 'granted') requestPerm();
            };

            return (
                <div className="w-full max-w-md mx-auto animate-fadeIn pt-4 flex flex-col h-full">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold">Tarefas</h2>
                        <button onClick={requestPerm} className={`p-2 rounded-full ${notifyPerm === 'granted' ? 'text-indigo-500 bg-indigo-500/10' : 'text-gray-400'}`}>
                            {notifyPerm === 'granted' ? <Icons.BellRing size={20} /> : <Icons.BellOff size={20} />}
                        </button>
                    </div>
                    
                    {notifyPerm !== 'granted' && (
                        <button onClick={requestPerm} className="w-full mb-4 bg-yellow-500/10 border border-yellow-500/20 text-yellow-600 dark:text-yellow-400 p-3 rounded-xl text-sm font-medium flex items-center justify-center gap-2 hover:bg-yellow-500/20 transition-all">
                            <Icons.BellRing size={16} /> Ativar notificações no navegador
                        </button>
                    )}
                    
                    <form onSubmit={addTask} className="flex flex-col gap-3 mb-6 bg-white dark:bg-gray-800 p-4 rounded-2xl border border-gray-100 dark:border-gray-700">
                        <input type="text" value={input} onChange={(e) => setInput(e.target.value)} placeholder="Nova tarefa..." className="w-full bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 p-3 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500 transition-all placeholder-gray-500"/>
                        <div className="flex justify-between items-center">
                            <input type="time" value={timeInput} onChange={(e) => setTimeInput(e.target.value)} className="bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 px-3 py-2 rounded-lg text-sm outline-none" />
                            <button type="submit" className="bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2 rounded-lg font-medium text-sm transition-colors">Adicionar</button>
                        </div>
                    </form>

                    <div className="flex-1 overflow-y-auto space-y-3 pb-32">
                        {tasks.length === 0 && <div className="text-center py-10 opacity-40"><Icons.CheckCircle size={48} className="mx-auto mb-2"/><p>Lista vazia.</p></div>}
                        {tasks.map(t => (
                            <div key={t.id} className={`flex items-center p-4 rounded-xl border transition-all ${t.done ? 'opacity-50 bg-gray-50 dark:bg-gray-800/50' : 'bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700'}`}>
                                <button onClick={() => setTasks(tasks.map(x => x.id === t.id ? {...x, done: !x.done} : x))} className={`w-6 h-6 rounded-full border-2 mr-4 flex items-center justify-center ${t.done ? 'bg-emerald-500 border-emerald-500 text-white' : 'border-gray-400'}`}>{t.done && <Icons.CheckCircle size={14} />}</button>
                                <div className="flex-1">
                                    <p className={`${t.done ? 'line-through' : ''} text-sm font-medium`}>{t.text}</p>
                                    {t.time && <p className="text-xs text-indigo-400 mt-1 flex items-center gap-1"><Icons.Bell size={10} /> {t.time}</p>}
                                </div>
                                <button onClick={() => setTasks(tasks.filter(x => x.id !== t.id))} className="text-gray-400 hover:text-red-500 p-2"><Icons.Trash2 /></button>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const RelaxZone = () => {
            const [tab, setTab] = useState('bubble');
            const playPop = () => { const a = new Audio('bubble.mp3'); a.volume=0.5; a.play().catch(()=>{}); if(navigator.vibrate) navigator.vibrate(50); };
            
            const BubbleWrap = () => {
                const [bubbles, setBubbles] = useState(Array(20).fill(false));
                const pop = (i) => { if(bubbles[i]) return; playPop(); const n = [...bubbles]; n[i] = true; setBubbles(n); };
                return (
                    <div className="flex flex-col items-center w-full">
                        <div className="grid grid-cols-4 gap-4 mb-6">
                            {bubbles.map((p, i) => (
                                <button key={i} onClick={() => pop(i)} className={`w-16 h-16 rounded-full shadow-inner transition-all ${p ? 'bg-transparent border-2 border-dashed border-gray-600 scale-90' : 'bg-gradient-to-br from-indigo-400 to-blue-600 shadow-xl scale-100 active:scale-90'}`}></button>
                            ))}
                        </div>
                        <button onClick={() => setBubbles(Array(20).fill(false))} className="text-indigo-400 underline text-sm">Novo Plástico</button>
                    </div>
                );
            };

            const Breathing = () => {
                const [phase, setPhase] = useState('Inspire');
                useEffect(() => {
                    const cycle = () => { setPhase('Inspire'); setTimeout(() => { setPhase('Segure'); setTimeout(() => { setPhase('Expire'); }, 4000); }, 4000); };
                    cycle(); const i = setInterval(cycle, 12000); return () => clearInterval(i);
                }, []);
                return (
                    <div className="flex flex-col items-center justify-center py-10">
                        <div className="relative flex items-center justify-center w-64 h-64">
                            <div className={`absolute rounded-full bg-indigo-500/30 transition-all duration-[4000ms] ease-in-out ${phase==='Inspire'?'w-64 h-64':phase==='Segure'?'w-64 h-64':'w-24 h-24'}`}></div>
                            <div className={`absolute rounded-full bg-indigo-500 flex items-center justify-center text-white font-bold text-xl shadow-lg transition-all duration-[4000ms] ease-in-out ${phase==='Inspire'?'w-48 h-48':phase==='Segure'?'w-48 h-48':'w-16 h-16 text-[0px]'}`}>{phase === 'Expire' ? '' : phase}</div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="w-full max-w-md mx-auto animate-fadeIn pt-4 flex flex-col items-center">
                    <div className="flex bg-gray-100 dark:bg-gray-800 p-1 rounded-full mb-8">
                        <button onClick={() => setTab('bubble')} className={`px-6 py-2 rounded-full text-sm font-medium transition-all ${tab === 'bubble' ? 'bg-white dark:bg-gray-700 text-indigo-500 shadow-sm' : 'text-gray-500'}`}>Bolhas</button>
                        <button onClick={() => setTab('breathe')} className={`px-6 py-2 rounded-full text-sm font-medium transition-all ${tab === 'breathe' ? 'bg-white dark:bg-gray-700 text-indigo-500 shadow-sm' : 'text-gray-500'}`}>Respirar</button>
                    </div>
                    {tab === 'bubble' ? <BubbleWrap /> : <Breathing />}
                </div>
            );
        };

        const ModalContent = ({ close }) => {
            const [slide, setSlide] = useState('donate');
            const toast = useToast();
            return (
                <div className="relative w-full max-w-sm h-[480px] bg-white dark:bg-slate-800 dark:text-white rounded-3xl shadow-2xl overflow-hidden flex flex-col">
                    <div className="flex border-b border-gray-100 dark:border-gray-700">
                        <button onClick={() => setSlide('donate')} className={`flex-1 py-4 text-sm font-bold transition-colors ${slide === 'donate' ? 'text-indigo-500 border-b-2 border-indigo-500' : 'text-gray-400'}`}>APOIAR</button>
                        <button onClick={() => setSlide('about')} className={`flex-1 py-4 text-sm font-bold transition-colors ${slide === 'about' ? 'text-indigo-500 border-b-2 border-indigo-500' : 'text-gray-400'}`}>SOBRE MIM</button>
                    </div>
                    <button onClick={close} className="absolute top-4 right-4 z-10 text-gray-400 hover:text-red-500"><Icons.X /></button>
                    <div className="flex-1 relative">
                        <div className={`absolute w-[200%] h-full flex transition-transform duration-500 ease-in-out ${slide === 'about' ? '-translate-x-1/2' : 'translate-x-0'}`}>
                            <div className="w-1/2 h-full p-6 flex flex-col items-center justify-center space-y-4">
                                <div className="w-20 h-20 bg-gradient-to-tr from-yellow-400 to-orange-500 rounded-full flex items-center justify-center shadow-lg animate-pop"><Icons.Coffee size={40} className="text-white" /></div>
                                <h3 className="text-2xl font-bold dark:text-white">Cafézinho?</h3>
                                <div className="bg-white p-2 rounded-xl border-2 border-dashed border-gray-300 w-40 h-40 flex items-center justify-center">
                                    <img src="qr.png" className="max-w-full max-h-full object-contain" onError={(e) => {e.target.style.display='none'; e.target.nextSibling.style.display='block'}} />
                                    <span className="hidden text-xs text-gray-400 text-center">QR Code<br/>não encontrado</span>
                                </div>
                                <button onClick={() => {navigator.clipboard.writeText('schenkel.mario@hotmail.com'); toast("Chave PIX copiada!");}} className="w-full py-3 bg-indigo-600 hover:bg-indigo-700 active:scale-95 text-white rounded-xl font-bold text-sm transition-all shadow-lg">Copiar Chave PIX</button>
                            </div>
                            <div className="w-1/2 h-full p-6 flex flex-col items-center justify-center space-y-5 text-center">
                                <div className="w-24 h-24 rounded-full overflow-hidden border-4 border-indigo-500 shadow-xl bg-gray-200 flex items-center justify-center">
                                    <img src="profile.png" className="w-full h-full object-cover" onError={(e) => {e.target.style.display='none'; e.target.nextSibling.style.display='flex'}} />
                                    <div className="hidden w-full h-full bg-slate-700 items-center justify-center text-white"><Icons.User size={40} /></div>
                                </div>
                                <div><h3 className="text-xl font-bold dark:text-white">Mário Schenkel</h3><p className="text-indigo-500 text-sm font-medium">Criador do ZenOffice</p></div>
                                <a href="https://linkedin.com/in/marioschenkel" target="_blank" className="flex items-center gap-2 px-6 py-3 bg-[#0077b5] text-white rounded-xl font-bold text-sm hover:opacity-90 transition-all shadow-lg"><Icons.Linkedin size={18} /> Conectar no LinkedIn</a>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const ZenOffice = () => {
            const [darkMode, setDarkMode] = useState(true);
            const [activeTab, setActiveTab] = useState('focus');
            const [showModal, setShowModal] = useState(false);
            const [deferredPrompt, setDeferredPrompt] = useState(null);
            const { level } = useContext(UserContext);

            useEffect(() => { window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); setDeferredPrompt(e); }); }, []);
            const installApp = async () => { if (deferredPrompt) { deferredPrompt.prompt(); setDeferredPrompt(null); } };
            const toggleTheme = () => setDarkMode(!darkMode);

            return (
                <div className={`fixed inset-0 transition-colors duration-500 font-sans ${darkMode ? 'bg-slate-900 text-gray-100' : 'bg-slate-50 text-gray-900'}`}>
                    <header className="fixed top-0 w-full p-4 flex justify-between items-center z-10 backdrop-blur-md bg-opacity-80 border-b border-gray-200 dark:border-gray-800">
                        <div className="flex items-center gap-3">
                            <img src="icon.png" className="w-9 h-9 rounded-xl shadow-md" onError={(e)=>e.target.style.display='none'} />
                            <h1 className="font-bold text-xl tracking-tight">ZenOffice</h1>
                            <span className="text-[10px] bg-indigo-500 text-white px-2 py-0.5 rounded-full font-bold">Lvl {level}</span>
                        </div>
                        <div className="flex gap-3">
                            {deferredPrompt && <button onClick={installApp} className="px-3 py-1 bg-emerald-600 text-white text-xs font-bold rounded-full animate-pulse shadow-lg">BAIXAR</button>}
                            <button onClick={toggleTheme} className="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-800 transition-colors">{darkMode ? <Icons.Sun /> : <Icons.Moon />}</button>
                        </div>
                    </header>

                    {/* Novo Layout de Scroll: Main ocupa tela toda, conteúdo centralizado */}
                    <main className="fixed top-0 left-0 w-full h-full pt-28 pb-32 overflow-y-auto">
                        <div className="w-full max-w-lg mx-auto px-6">
                            {activeTab === 'focus' && <FocusMode />}
                            {activeTab === 'tasks' && <TaskManager />}
                            {activeTab === 'stats' && <StatsPage />}
                            {activeTab === 'relax' && <RelaxZone />}
                        </div>
                    </main>

                    <div className="fixed bottom-24 right-6 z-30">
                        <button onClick={() => setShowModal(true)} className="group flex items-center justify-center w-14 h-14 bg-gradient-to-r from-yellow-400 to-orange-500 text-white rounded-full shadow-2xl hover:scale-110 hover:rotate-12 transition-all duration-300">
                            <Icons.Coffee size={24} />
                        </button>
                    </div>

                    {showModal && <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm animate-fadeIn"><ModalContent close={() => setShowModal(false)} /></div>}

                    <nav className={`fixed bottom-0 w-full pb-6 pt-2 border-t transition-colors z-20 ${darkMode ? 'bg-slate-900/90 border-gray-800' : 'bg-white/90 border-gray-200'} backdrop-blur-lg`}>
                        <div className="flex justify-around items-center max-w-md mx-auto">
                            {[{id:'focus',i:Icons.Brain,l:'Foco'},{id:'tasks',i:Icons.CheckCircle,l:'Tarefas'},{id:'stats',i:Icons.Award,l:'Stats'},{id:'relax',i:Icons.Wind,l:'Zen'}].map((t) => (
                                <button key={t.id} onClick={() => setActiveTab(t.id)} className={`relative flex flex-col items-center p-2 rounded-2xl w-16 transition-all duration-300 ${activeTab === t.id ? 'text-indigo-500 -translate-y-2' : 'text-gray-400 hover:text-gray-500'}`}>
                                    <div className={`absolute inset-0 bg-indigo-500/10 rounded-2xl scale-0 transition-transform ${activeTab === t.id ? 'scale-100' : ''}`}></div>
                                    <t.i size={24} className="z-10" />
                                    <span className={`text-[10px] mt-1 z-10 ${activeTab === t.id ? 'font-bold' : 'font-medium'}`}>{t.l}</span>
                                </button>
                            ))}
                        </div>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            <UserProvider>
                <ToastProvider>
                    <ZenOffice />
                </ToastProvider>
            </UserProvider>
        );
    </script>
    
    <script>
        if ('serviceWorker' in navigator) { window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js')); }
    </script>
</body>
</html>
